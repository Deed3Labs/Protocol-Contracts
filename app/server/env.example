# Server Configuration
PORT=3001
NODE_ENV=development

# Redis Configuration
# Option 1: Use REDIS_URL (recommended for cloud providers like Upstash)
REDIS_URL=redis://default:password@host:6379

# Option 2: Use individual settings (for local or custom Redis)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_TLS=false

# External API Keys (optional)
COINGECKO_API_KEY=
RPC_PROVIDER_API_KEY=

# Plaid API Keys (for bank linking and balance display)
# Get your keys from: https://dashboard.plaid.com/developers/keys
# PLAID_ENV: sandbox (development) or production
PLAID_CLIENT_ID=
PLAID_SECRET=
PLAID_ENV=sandbox
# Required for OAuth institutions (e.g. Chase) in web Link flows.
# Must be added in Plaid Dashboard -> Team settings -> Allowed redirect URIs.
# Example: https://app.example.com/
PLAID_REDIRECT_URI=

# Persistent encrypted Plaid token storage (Postgres + envelope encryption)
# DATABASE_URL is required so linked Plaid items survive restarts and multiple server instances.
DATABASE_URL=
# Optional Postgres tuning
# POSTGRES_POOL_MAX=10
# POSTGRES_IDLE_TIMEOUT_MS=30000
# POSTGRES_CONNECTION_TIMEOUT_MS=10000
# POSTGRES_SSL_MODE=require
# Optional table name override
# PLAID_TOKEN_STORE_TABLE=plaid_linked_items
#
# Encryption key configuration (AES-256 envelope encryption):
# Option A (simple): one active key (recommended minimum)
# - 32-byte key encoded as base64 or hex
# - Example generation: openssl rand -base64 32
PLAID_TOKEN_MASTER_KEY=
# Optional active key version label for rotation bookkeeping
PLAID_TOKEN_ACTIVE_KEY_VERSION=v1
#
# Option B (rotation): keyring JSON mapping versions to key material
# Example: {"v1":"base64:...","v2":"base64:..."}
# PLAID_TOKEN_KEYRING_JSON=

# Stripe API Keys (for crypto onramp)
# Get your keys from: https://dashboard.stripe.com/apikeys
# Note: You must submit an onramp application before using in production
# See: https://docs.stripe.com/crypto/onramp
STRIPE_SECRET_KEY=

# Bridge (ACH/wire funding to wallet)
# BRIDGE_FUNDING_URL_BASE: base URL for Bridge funding flow (query params: wallet, amount, currency, network)
# BRIDGE_ONBOARDING_URL_BASE: optional base URL for Bridge onboarding/direct-deposit setup (query params: wallet, intent, flow)
# BRIDGE_API_KEY: recommended for real hosted onboarding links (kyc_link + tos_link)
# BRIDGE_API_BASE_URL: Bridge API base (default: https://api.bridge.xyz/v0)
#   Sandbox: https://api.sandbox.bridge.xyz/v0
# BRIDGE_ONBOARDING_REDIRECT_URI: optional redirect URL Bridge should send users back to after hosted onboarding steps
# BRIDGE_API_TIMEOUT_MS: request timeout for Bridge API calls (default: 15000)
BRIDGE_FUNDING_URL_BASE=
BRIDGE_ONBOARDING_URL_BASE=
BRIDGE_API_KEY=
BRIDGE_API_BASE_URL=https://api.bridge.xyz/v0
BRIDGE_ONBOARDING_REDIRECT_URI=
# BRIDGE_API_TIMEOUT_MS=15000

# Send Funds (claim escrow + recipient payout)
# -----------------------------------------------------------------------------
# Public claim URL base used to generate links sent to recipients
# Example: https://app.deed3.io
SEND_CLAIM_APP_URL=http://localhost:5173

# At-rest encryption for recipient contact values (AES-256 key, base64/hex)
# Example generation: openssl rand -base64 32
SEND_CONTACT_ENCRYPTION_KEY=

# Optional peppers for claim/session token hashing and OTP hashing
SEND_TOKEN_PEPPER=
SEND_OTP_PEPPER=

# Send transfer defaults/limits
SEND_SPONSOR_FEE_USDC=0.50
SEND_TRANSFER_EXPIRY_DAYS=7
SEND_OTP_EXPIRY_MS=600000
SEND_OTP_MAX_ATTEMPTS=5
SEND_OTP_RESEND_COOLDOWN_MS=60000
# Dev-only OTP bypass (disabled by default). When enabled, use SEND_OTP_BYPASS_CODE to verify claims.
# Ignored when NODE_ENV=production.
SEND_OTP_BYPASS_ENABLED=false
SEND_OTP_BYPASS_CODE=000000
SEND_DEFAULT_CHAIN_ID=8453
SEND_ALLOWED_CHAIN_IDS=8453
SEND_ENABLED_REGIONS=US
SEND_DEBIT_ENABLED_REGIONS=US
SEND_BANK_ENABLED_REGIONS=US
SEND_WALLET_ENABLED_REGIONS=US
# Amounts below are in micro-USDC (6 decimals)
SEND_MAX_TRANSFER_USDC_MICROS=10000000000
SEND_DAILY_CAP_USDC_MICROS=25000000000

# Escrow/verification config
# Security critical: keep false in all shared/staging/prod environments.
# Ignored when NODE_ENV=production.
SEND_SKIP_ESCROW_TX_VERIFICATION=false
SEND_CLAIM_ESCROW_ADDRESS=0x4c2C91Ad8b1B5e0bAFe79B0592C9156E56221992
# Optional chain-specific overrides
SEND_CLAIM_ESCROW_ADDRESS_8453=0x4c2C91Ad8b1B5e0bAFe79B0592C9156E56221992
# Optional if you test on Base Sepolia
# SEND_CLAIM_ESCROW_ADDRESS_84532=
# Optional chain-specific RPC URLs used for on-chain tx verification
# SEND_RPC_URL_8453=
# Optional if you test on Base Sepolia
# SEND_RPC_URL_84532=

# Relayer (required for on-chain claim settlement in wallet/debit/bank paths)
# Modes:
# - local_key: signs with SEND_RELAYER_PRIVATE_KEY (legacy/dev)
# - managed_webhook: delegates signing/broadcasting to SEND_RELAYER_MANAGED_SIGNER_URL (recommended)
# - cdp_server_wallet: signs/broadcasts with Coinbase CDP Server Wallets (recommended managed signer)
SEND_RELAYER_MODE=local_key
# Optional safety control: when false, relayer config errors fail requests instead of simulated tx hashes
SEND_RELAYER_ALLOW_SIMULATION=true
# Receipt confirmation safety (recommended true in all non-local environments)
SEND_RELAYER_REQUIRE_RECEIPT_CONFIRMATION=true
SEND_RELAYER_RECEIPT_TIMEOUT_MS=120000
SEND_RELAYER_RECEIPT_POLL_MS=2000
# Local key mode
SEND_RELAYER_RPC_URL=https://base-mainnet.g.alchemy.com/v2/0rVprZ-kS_Zb7UhWSs2ZlONOTZpC2E79
SEND_RELAYER_PRIVATE_KEY=
# Managed signer webhook mode
SEND_RELAYER_MANAGED_SIGNER_URL=
SEND_RELAYER_MANAGED_SIGNER_SECRET=
SEND_RELAYER_MANAGED_SIGNER_TIMEOUT_MS=15000
# CDP Server Wallet mode
# If SEND_* vars are blank, service falls back to CDP_API_KEY_ID / CDP_API_KEY_SECRET / CDP_WALLET_SECRET.
SEND_CDP_API_KEY_ID=
SEND_CDP_API_KEY_SECRET=
SEND_CDP_WALLET_SECRET=
# Optional CDP API base path override (defaults to CDP production API)
SEND_CDP_BASE_PATH=
# Optional network override. If unset, chainId maps automatically (8453->base, 84532->base-sepolia).
SEND_CDP_NETWORK=base
# SEND_CDP_NETWORK_84532=base-sepolia
# Managed relayer account name (created automatically if missing)
SEND_CDP_EVM_ACCOUNT_NAME=send-relayer-base-mainnet
# Optional chain-specific account names
# SEND_CDP_EVM_ACCOUNT_NAME_8453=send-relayer-base-mainnet
# SEND_CDP_EVM_ACCOUNT_NAME_84532=send-relayer-base-sepolia
# Optional explicit CDP account address override (must already exist in this CDP project)
SEND_CDP_EVM_ACCOUNT_ADDRESS=
# SEND_CDP_EVM_ACCOUNT_ADDRESS_8453=

# Optional payout treasury address used by deploy scripts
SEND_PAYOUT_TREASURY=0x52e6102B7C22eeC7A68B11Dd71faC7D6D9AEcf50

# Notification provider mode
# - mock: logs/simulates notifications (default)
# - generic_webhook: calls SEND_NOTIFICATION_WEBHOOK_URL
# - twilio: sends SMS via Twilio (email recipients require webhook fallback)
SEND_NOTIFICATION_PROVIDER=mock
SEND_NOTIFICATION_WEBHOOK_URL=
SEND_NOTIFICATION_WEBHOOK_SECRET=
SEND_NOTIFICATION_WEBHOOK_TIMEOUT_MS=12000
# Twilio notification config (used when SEND_NOTIFICATION_PROVIDER=twilio)
SEND_TWILIO_ACCOUNT_SID=
SEND_TWILIO_AUTH_TOKEN=
# Use either Messaging Service SID (recommended) or a single From number
SEND_TWILIO_MESSAGING_SERVICE_SID=
SEND_TWILIO_FROM_PHONE_NUMBER=
# Optional status callback for Twilio delivery events
SEND_TWILIO_STATUS_CALLBACK_URL=
# Optional Twilio API base override
SEND_TWILIO_API_BASE_URL=https://api.twilio.com/2010-04-01

# Fiat payout provider mode
# - mock: simulates payout results
# - generic_webhook: calls SEND_PAYOUT_PROVIDER_URL
# - bridge_only: bridge handles fiat conversion + fiat disbursement directly
# - stripe_bridge_jit: bridge transfer conversion + stripe connected-account payout
SEND_PAYOUT_PROVIDER=mock
SEND_PAYOUT_PROVIDER_URL=
SEND_PAYOUT_PROVIDER_SECRET=
SEND_PAYOUT_WEBHOOK_SECRET=
SEND_PAYOUT_WEBHOOK_TIMEOUT_MS=15000

# Optional display/provider labels + debit simulation controls
SEND_DEBIT_PROVIDER=mock-debit
SEND_BANK_PROVIDER=mock-bank
SEND_FORCE_DEBIT_FALLBACK=false
SEND_DEBIT_MAX_USDC_MICROS=2500000000

# Bridge payout configuration (used when SEND_PAYOUT_PROVIDER=bridge_only or stripe_bridge_jit)
# Uses Bridge Transfers API (default path /transfers on BRIDGE_API_BASE_URL)
SEND_BRIDGE_PAYOUT_PROVIDER_NAME=bridge
SEND_BRIDGE_PAYOUT_API_KEY=
SEND_BRIDGE_PAYOUT_API_KEY_HEADER=Api-Key
SEND_BRIDGE_PAYOUT_PATH=/transfers
SEND_BRIDGE_PAYOUT_TIMEOUT_MS=15000
SEND_BRIDGE_PAYOUT_ENABLED_REGIONS=US
SEND_BRIDGE_ON_BEHALF_OF=
# Enable recipient onboarding checks in bridge_only mode (recommended for direct recipient fiat payout rails)
SEND_BRIDGE_REQUIRE_RECIPIENT_ONBOARDING=false
SEND_BRIDGE_RECIPIENT_CUSTOMER_TYPE=individual
SEND_BRIDGE_RECIPIENT_DEFAULT_FULL_NAME=Recipient User
SEND_BRIDGE_USE_RECIPIENT_ON_BEHALF_OF=true
SEND_BRIDGE_EXTERNAL_ACCOUNT_LOOKUP_LIMIT=10
# Optional redirect URI for hosted onboarding links (falls back to SEND_CLAIM_APP_URL/claim)
SEND_BRIDGE_ONBOARDING_REDIRECT_URI=
# Shared recipient destination override (fallback when method-specific vars are not set)
SEND_BRIDGE_RECIPIENT_DESTINATION_PAYMENT_RAIL=
SEND_BRIDGE_RECIPIENT_DESTINATION_CURRENCY=
# Method-specific recipient destination overrides (recommended)
# - For debit selection, set a debit/card-compatible rail
SEND_BRIDGE_RECIPIENT_DEBIT_DESTINATION_PAYMENT_RAIL=
SEND_BRIDGE_RECIPIENT_DEBIT_DESTINATION_CURRENCY=usd
# - For bank selection, set ACH (or your regional bank rail)
SEND_BRIDGE_RECIPIENT_BANK_DESTINATION_PAYMENT_RAIL=ach
SEND_BRIDGE_RECIPIENT_BANK_DESTINATION_CURRENCY=usd
# Optional hints for filtering recipient external accounts by method (comma-separated rails)
SEND_BRIDGE_RECIPIENT_DEBIT_EXTERNAL_ACCOUNT_RAILS=
SEND_BRIDGE_RECIPIENT_BANK_EXTERNAL_ACCOUNT_RAILS=ach
# Optional full overrides for Bridge transfer source/destination objects (JSON)
# SEND_BRIDGE_TRANSFER_SOURCE_JSON={"payment_rail":"base","currency":"usdc","from_address":"0x..."}
# SEND_BRIDGE_TRANSFER_DESTINATION_JSON={"payment_rail":"prefunded","currency":"usd","prefunded_account_id":"..."}
# Optional decomposed source/destination config (used when JSON overrides are absent)
SEND_BRIDGE_SOURCE_PAYMENT_RAIL=base
SEND_BRIDGE_SOURCE_CURRENCY=usdc
SEND_BRIDGE_SOURCE_FROM_ADDRESS=
SEND_BRIDGE_SOURCE_BRIDGE_WALLET_ID=
SEND_BRIDGE_DESTINATION_PAYMENT_RAIL=prefunded
SEND_BRIDGE_DESTINATION_CURRENCY=usd
SEND_BRIDGE_DESTINATION_PREFUNDED_ACCOUNT_ID=
SEND_BRIDGE_DESTINATION_EXTERNAL_ACCOUNT_ID=
SEND_BRIDGE_DESTINATION_ADDRESS=
# Bridge webhook verification (official model)
# - Bridge sends: X-Webhook-Signature: t=<unix>,v0=<base64_signature>
# - SEND_BRIDGE_WEBHOOK_PUBLIC_KEY supports PEM or base64-encoded DER public key
SEND_BRIDGE_WEBHOOK_PUBLIC_KEY=
# Optional rotation set (comma-separated); used in addition to SEND_BRIDGE_WEBHOOK_PUBLIC_KEY
SEND_BRIDGE_WEBHOOK_PUBLIC_KEYS=
# Signature timestamp tolerance window
SEND_BRIDGE_WEBHOOK_MAX_AGE_SECONDS=300
# Legacy shared-secret fallback for custom webhook senders (not Bridge official signature model)
SEND_BRIDGE_WEBHOOK_SECRET=

# Stripe connected-account payouts (only used by stripe_bridge_jit)
SEND_STRIPE_PAYOUT_PROVIDER_NAME=stripe
SEND_STRIPE_PAYOUT_CURRENCY=usd
SEND_STRIPE_PAYOUT_TIMEOUT_MS=15000
SEND_STRIPE_BANK_ETA=1-3 business days
SEND_STRIPE_DEBIT_ENABLED=true
SEND_STRIPE_ENABLE_INSTANT_PAYOUTS=true
# Require bridge conversion status=SUCCESS before creating stripe payout
SEND_STRIPE_REQUIRE_BRIDGE_SUCCESS=true
# Auto-create recipient Connect accounts when missing
SEND_STRIPE_AUTO_CREATE_CONNECTED_ACCOUNT=true
# Connect account defaults for auto-provisioned recipients
SEND_STRIPE_CONNECTED_ACCOUNT_TYPE=express
SEND_STRIPE_CONNECTED_ACCOUNT_COUNTRY=US
# Recipient onboarding links (required for auto-linking incomplete accounts)
SEND_STRIPE_ONBOARDING_RETURN_URL=
SEND_STRIPE_ONBOARDING_REFRESH_URL=
# Connected account selection:
# - default single connected account for all recipients
SEND_STRIPE_DEFAULT_CONNECTED_ACCOUNT_ID=
# - optional per-recipient mapping by recipient_contact_hash or recipient_hint_hash (lowercase)
# SEND_STRIPE_RECIPIENT_ACCOUNT_MAP_JSON={"<recipient_contact_hash>":"acct_xxx","default":"acct_default"}
SEND_STRIPE_RECIPIENT_ACCOUNT_MAP_JSON=

# OpenSea API Key (for NFT floor price fallback)
# Get your free API key at: https://docs.opensea.io/reference/api-overview
# Required for NFT pricing on non-Ethereum chains (Base, Polygon, Arbitrum, etc.)
# Alchemy NFT API is used for Ethereum mainnet, OpenSea is fallback
OPENSEA_API_KEY=

# Alchemy API Key (recommended for production)
# Get your free API key at: https://dashboard.alchemy.com/
# If set, will automatically construct Alchemy RPC URLs for all supported chains
# This is the easiest way to use Alchemy - just set this one variable!
ALCHEMY_API_KEY=

# Alchemy compute unit alerts (optional)
# ALCHEMY_CU_ALERT_THRESHOLD=100000   # Per-user 24h; warn if user exceeds this (default 100000)
# ALCHEMY_CU_DAILY_ALERT_THRESHOLD=   # Global 24h; warn if total 24h CUs exceed this (e.g. 2000000)

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100
# Global limiter scope:
# - path (recommended): per IP+method+path buckets
# - ip: single bucket per IP across all API routes
RATE_LIMIT_SCOPE=path

# Cache TTLs (in seconds)
CACHE_TTL_PRICE=300  # 5 minutes - aligned with WebSocket price update interval
CACHE_TTL_BALANCE=300  # 5 minutes - increased from 10s to align with WebSocket balance update interval (5 min) and reduce Alchemy compute unit usage
CACHE_TTL_PLAID_BALANCES=3600  # 1 hour - Plaid bank balance cache (~$0.10/call). Use ?refresh=1 to bypass.
CACHE_TTL_PLAID_RECURRING=86400  # 24 hours - recurring streams change rarely (monthly). Use ?refresh=1 to bypass.
CACHE_TTL_PLAID_SPEND=3600  # 1 hour - spend-by-day for current month. Use ?refresh=1 to bypass.
CACHE_TTL_PLAID_LIABILITIES=3600  # 1 hour - credit/loan liability detail cache. Use ?refresh=1 to bypass.
CACHE_TTL_PLAID_INVESTMENT_ACCOUNTS=3600  # 1 hour - investment account summary cache. Use ?refresh=1 to bypass.
CACHE_TTL_NFT=1800  # 30 minutes - increased to reduce Alchemy compute unit usage
CACHE_TTL_TRANSACTION=600  # 10 minutes - increased to align with refresh intervals and reduce Alchemy compute unit usage
CACHE_TTL_RPC=5  # 5 seconds - short TTL for RPC calls (quick cache for repeated requests)

# CORS
CORS_ORIGIN=http://localhost:5173
ALLOW_VERCEL_PREVIEWS=false
# Set true to require explicit CORS_ORIGIN (otherwise compatibility mode allows all origins)
STRICT_CORS=false

# Reown / SIWX auth verification
# Required for protected routes: /api/stripe, /api/plaid, /api/bridge
# Set to the same project ID used by the frontend AppKit config.
REOWN_PROJECT_ID=
# Optional overrides (defaults shown)
# REOWN_AUTH_BASE_URL=https://api.web3modal.org
# REOWN_SDK_TYPE=appkit
# REOWN_SDK_VERSION=html-wagmi-4.2.2
# AUTH_CACHE_TTL_MS=300000

# Plaid limits
# Maximum number of linked Plaid items per wallet
MAX_PLAID_ITEMS_PER_WALLET=10

# RPC URLs (optional - only needed if you want to override Alchemy URLs or use a different provider)
# Priority: Custom URL > Alchemy (if ALCHEMY_API_KEY set) > Public fallback
# If you set ALCHEMY_API_KEY above, you don't need to set these individually
# Format examples:
#   ETHEREUM_RPC_URL=https://eth-mainnet.g.alchemy.com/v2/YOUR_API_KEY
#   SEPOLIA_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY
ETHEREUM_RPC_URL=
BASE_RPC_URL=
GNOSIS_RPC_URL=
POLYGON_RPC_URL=
ARBITRUM_RPC_URL=
SEPOLIA_RPC_URL=
BASE_SEPOLIA_RPC_URL=
MUMBAI_RPC_URL=
